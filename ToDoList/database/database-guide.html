<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’¾ æ•°æ®åº“ä»£ç å¤§å…¨ - å…¨æ ˆå¼€å‘é“¶æ²³ç³»</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’¾</text></svg>">
    <style>
        .code-section {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            margin: 24px 0;
            overflow: hidden;
        }
        
        .code-header {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            padding: 16px 24px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .code-header.sql {
            background: linear-gradient(135deg, #4299e1, #3182ce);
        }
        
        .code-header.nosql {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }
        
        .code-header.redis {
            background: linear-gradient(135deg, #dc143c, #b91c1c);
        }
        
        .code-content {
            padding: 24px;
        }
        
        .difficulty-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: var(--border-radius);
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: auto;
        }
        
        .difficulty-beginner {
            background: var(--success-light);
            color: var(--success-color);
        }
        
        .difficulty-intermediate {
            background: var(--warning-light);
            color: var(--warning-color);
        }
        
        .difficulty-advanced {
            background: var(--error-light);
            color: var(--error-color);
        }
        
        .preview-box {
            background: var(--light-gray);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 16px;
            margin: 16px 0;
        }
        
        .preview-title {
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 12px;
        }
        
        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 16px 0;
        }
        
        .tag {
            background: var(--primary-light);
            color: var(--primary-color);
            padding: 4px 8px;
            border-radius: var(--border-radius);
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .tag.sql {
            background: #4299e1;
            color: white;
        }
        
        .tag.nosql {
            background: #48bb78;
            color: white;
        }
        
        .tag.redis {
            background: #dc143c;
            color: white;
        }
        
        .example-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin: 32px 0;
        }
        
        .copy-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--glass-background);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .copy-btn:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .code-container {
            position: relative;
        }
        
        .result-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 16px;
            border-radius: var(--border-radius);
            margin: 16px 0;
            font-family: 'Courier New', monospace;
            border-left: 4px solid var(--info-color);
        }
        
        .result-title {
            color: var(--info-color);
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .schema-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: var(--border-radius);
            padding: 16px;
            margin: 16px 0;
            font-family: 'Courier New', monospace;
        }
        
        .schema-title {
            color: var(--secondary-color);
            font-weight: 600;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="layout">
        <div class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">ğŸ’¾ æ•°æ®åº“ä»£ç å¤§å…¨</div>
                <ul class="sidebar-list">
                    <li><a href="#sql-basics">SQL åŸºç¡€</a></li>
                    <li><a href="#sql-advanced">SQL é«˜çº§</a></li>
                    <li><a href="#mysql">MySQL ä¸“é¢˜</a></li>
                    <li><a href="#postgresql">PostgreSQL</a></li>
                    <li><a href="#mongodb">MongoDB</a></li>
                    <li><a href="#redis">Redis ç¼“å­˜</a></li>
                    <li><a href="#transactions">äº‹åŠ¡å¤„ç†</a></li>
                    <li><a href="#indexing">ç´¢å¼•ä¼˜åŒ–</a></li>
                    <li><a href="#backup">å¤‡ä»½æ¢å¤</a></li>
                    <li><a href="#performance">æ€§èƒ½è°ƒä¼˜</a></li>
                    <li><a href="#security">å®‰å…¨é…ç½®</a></li>
                    <li><a href="#migration">æ•°æ®è¿ç§»</a></li>
                </ul>
            </div>
        </div>

        <div class="main-content">
            <div class="info-bar">
                <input type="text" class="search-box" placeholder="ğŸ” æœç´¢æ•°æ®åº“ä»£ç ...">
                <a href="../index.html">ğŸ  è¿”å›é¦–é¡µ</a>
                <button onclick="toggleSidebar()">ğŸ“‹ ç›®å½•</button>
                <button onclick="toggleTheme()">ğŸŒ™ ä¸»é¢˜</button>
                <button onclick="window.scrollTo(0,0)">â¬†ï¸ é¡¶éƒ¨</button>
            </div>

            <div class="container">
                <h1>ğŸ’¾ æ•°æ®åº“ä»£ç å¤§å…¨</h1>
                <p style="text-align: center; font-size: 1.2rem; color: var(--text-secondary); margin-bottom: 40px;">
                    å®Œæ•´çš„æ•°æ®åº“ä»£ç ç¤ºä¾‹åº“ï¼Œæ¶µç›–SQLã€NoSQLç­‰ä¸»æµæ•°æ®åº“æŠ€æœ¯
                </p>

                <section id="sql-basics">
                    <h2>ğŸ—ƒï¸ SQL åŸºç¡€æ“ä½œ</h2>
                    
                    <div class="code-section">
                        <div class="code-header sql">
                            <span>ğŸ—ï¸ æ•°æ®åº“å’Œè¡¨çš„åˆ›å»º</span>
                            <span class="difficulty-badge difficulty-beginner">åˆçº§</span>
                        </div>
                        <div class="code-content">
                            <div class="tag-list">
                                <span class="tag sql">SQL</span>
                                <span class="tag">DDL</span>
                                <span class="tag">åˆ›å»º</span>
                            </div>
                            <div class="code-container">
                                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                                <div class="code">
                                    <pre>-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE company_db 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;

-- ä½¿ç”¨æ•°æ®åº“
USE company_db;

-- åˆ›å»ºç”¨æˆ·è¡¨
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    phone VARCHAR(20),
    birth_date DATE,
    gender ENUM('M', 'F', 'Other'),
    status ENUM('active', 'inactive', 'suspended') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    -- ç´¢å¼•
    INDEX idx_username (username),
    INDEX idx_email (email),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
);

-- åˆ›å»ºéƒ¨é—¨è¡¨
CREATE TABLE departments (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    manager_id INT,
    budget DECIMAL(15,2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (manager_id) REFERENCES users(id) ON DELETE SET NULL
);

-- åˆ›å»ºå‘˜å·¥è¡¨
CREATE TABLE employees (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    employee_id VARCHAR(20) NOT NULL UNIQUE,
    department_id INT,
    position VARCHAR(100),
    salary DECIMAL(10,2),
    hire_date DATE NOT NULL,
    manager_id INT,
    
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (department_id) REFERENCES departments(id) ON DELETE SET NULL,
    FOREIGN KEY (manager_id) REFERENCES employees(id) ON DELETE SET NULL,
    
    INDEX idx_employee_id (employee_id),
    INDEX idx_department (department_id),
    INDEX idx_hire_date (hire_date)
);

-- åˆ›å»ºé¡¹ç›®è¡¨
CREATE TABLE projects (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    start_date DATE,
    end_date DATE,
    budget DECIMAL(15,2),
    status ENUM('planning', 'active', 'completed', 'cancelled') DEFAULT 'planning',
    manager_id INT,
    
    FOREIGN KEY (manager_id) REFERENCES employees(id) ON DELETE SET NULL,
    
    INDEX idx_status (status),
    INDEX idx_dates (start_date, end_date)
);

-- åˆ›å»ºé¡¹ç›®æˆå‘˜å…³è”è¡¨ï¼ˆå¤šå¯¹å¤šå…³ç³»ï¼‰
CREATE TABLE project_members (
    id INT PRIMARY KEY AUTO_INCREMENT,
    project_id INT NOT NULL,
    employee_id INT NOT NULL,
    role VARCHAR(50),
    joined_date DATE DEFAULT (CURRENT_DATE),
    
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (employee_id) REFERENCES employees(id) ON DELETE CASCADE,
    
    UNIQUE KEY unique_project_employee (project_id, employee_id),
    INDEX idx_project (project_id),
    INDEX idx_employee (employee_id)
);</pre>
                                </div>
                            </div>
                            <div class="schema-box">
                                <div class="schema-title">ğŸ“Š æ•°æ®åº“ç»“æ„è¯´æ˜ï¼š</div>
                                â€¢ users: ç”¨æˆ·åŸºç¡€ä¿¡æ¯è¡¨<br>
                                â€¢ departments: éƒ¨é—¨ä¿¡æ¯è¡¨<br>
                                â€¢ employees: å‘˜å·¥ä¿¡æ¯è¡¨ï¼ˆå…³è”ç”¨æˆ·å’Œéƒ¨é—¨ï¼‰<br>
                                â€¢ projects: é¡¹ç›®ä¿¡æ¯è¡¨<br>
                                â€¢ project_members: é¡¹ç›®æˆå‘˜å…³è”è¡¨ï¼ˆå¤šå¯¹å¤šï¼‰
                            </div>
                        </div>
                    </div>

                    <div class="code-section">
                        <div class="code-header sql">
                            <span>ğŸ“ æ•°æ®æ’å…¥æ“ä½œ</span>
                            <span class="difficulty-badge difficulty-beginner">åˆçº§</span>
                        </div>
                        <div class="code-content">
                            <div class="code-container">
                                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                                <div class="code">
                                    <pre>-- æ’å…¥ç”¨æˆ·æ•°æ®
INSERT INTO users (username, email, password_hash, first_name, last_name, phone, birth_date, gender) VALUES
('zhangsan', 'zhangsan@company.com', 'hashed_password_1', 'ä¸‰', 'å¼ ', '13800138001', '1990-05-15', 'M'),
('lisi', 'lisi@company.com', 'hashed_password_2', 'å››', 'æ', '13800138002', '1988-08-20', 'F'),
('wangwu', 'wangwu@company.com', 'hashed_password_3', 'äº”', 'ç‹', '13800138003', '1992-12-10', 'M'),
('zhaoliu', 'zhaoliu@company.com', 'hashed_password_4', 'å…­', 'èµµ', '13800138004', '1985-03-25', 'F'),
('sunqi', 'sunqi@company.com', 'hashed_password_5', 'ä¸ƒ', 'å­™', '13800138005', '1993-07-08', 'M');

-- æ’å…¥éƒ¨é—¨æ•°æ®
INSERT INTO departments (name, description, manager_id, budget) VALUES
('æŠ€æœ¯éƒ¨', 'è´Ÿè´£å…¬å¸æŠ€æœ¯ç ”å‘å’Œäº§å“å¼€å‘', 1, 1000000.00),
('å¸‚åœºéƒ¨', 'è´Ÿè´£å¸‚åœºæ¨å¹¿å’Œé”€å”®', 2, 500000.00),
('äººäº‹éƒ¨', 'è´Ÿè´£äººåŠ›èµ„æºç®¡ç†', 3, 300000.00),
('è´¢åŠ¡éƒ¨', 'è´Ÿè´£è´¢åŠ¡ç®¡ç†å’Œä¼šè®¡', 4, 200000.00);

-- æ’å…¥å‘˜å·¥æ•°æ®
INSERT INTO employees (user_id, employee_id, department_id, position, salary, hire_date, manager_id) VALUES
(1, 'EMP001', 1, 'æŠ€æœ¯æ€»ç›‘', 25000.00, '2020-01-15', NULL),
(2, 'EMP002', 2, 'å¸‚åœºæ€»ç›‘', 22000.00, '2020-02-01', NULL),
(3, 'EMP003', 3, 'äººäº‹æ€»ç›‘', 20000.00, '2020-03-01', NULL),
(4, 'EMP004', 4, 'è´¢åŠ¡æ€»ç›‘', 23000.00, '2020-04-01', NULL),
(5, 'EMP005', 1, 'é«˜çº§å¼€å‘å·¥ç¨‹å¸ˆ', 18000.00, '2021-06-15', 1);

-- æ’å…¥é¡¹ç›®æ•°æ®
INSERT INTO projects (name, description, start_date, end_date, budget, status, manager_id) VALUES
('ç”µå•†å¹³å°å¼€å‘', 'å¼€å‘æ–°ä¸€ä»£ç”µå•†å¹³å°ç³»ç»Ÿ', '2023-01-01', '2023-12-31', 2000000.00, 'active', 1),
('ç§»åŠ¨APPå¼€å‘', 'å¼€å‘å…¬å¸å®˜æ–¹ç§»åŠ¨åº”ç”¨', '2023-03-01', '2023-09-30', 800000.00, 'active', 1),
('æ•°æ®åˆ†æç³»ç»Ÿ', 'æ„å»ºä¼ä¸šæ•°æ®åˆ†æå¹³å°', '2023-06-01', '2024-03-31', 1500000.00, 'planning', 1);

-- æ’å…¥é¡¹ç›®æˆå‘˜å…³è”æ•°æ®
INSERT INTO project_members (project_id, employee_id, role, joined_date) VALUES
(1, 1, 'é¡¹ç›®ç»ç†', '2023-01-01'),
(1, 5, 'å¼€å‘å·¥ç¨‹å¸ˆ', '2023-01-15'),
(2, 1, 'æŠ€æœ¯é¡¾é—®', '2023-03-01'),
(2, 5, 'ä¸»è¦å¼€å‘è€…', '2023-03-01'),
(3, 1, 'é¡¹ç›®ç»ç†', '2023-06-01');

-- æ‰¹é‡æ’å…¥ç¤ºä¾‹ï¼ˆä½¿ç”¨å­æŸ¥è¯¢ï¼‰
INSERT INTO project_members (project_id, employee_id, role)
SELECT 
    p.id,
    e.id,
    'å›¢é˜Ÿæˆå‘˜'
FROM projects p
CROSS JOIN employees e
WHERE p.name = 'ç”µå•†å¹³å°å¼€å‘' 
  AND e.department_id = 1 
  AND e.id NOT IN (SELECT employee_id FROM project_members WHERE project_id = p.id);

-- æ¡ä»¶æ’å…¥ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™æ’å…¥ï¼‰
INSERT IGNORE INTO users (username, email, password_hash, first_name, last_name)
VALUES ('admin', 'admin@company.com', 'admin_hash', 'Admin', 'User');

-- æ’å…¥æˆ–æ›´æ–°ï¼ˆMySQLç‰¹æœ‰è¯­æ³•ï¼‰
INSERT INTO users (username, email, password_hash, first_name, last_name)
VALUES ('testuser', 'test@company.com', 'test_hash', 'Test', 'User')
ON DUPLICATE KEY UPDATE
    password_hash = VALUES(password_hash),
    updated_at = CURRENT_TIMESTAMP;</pre>
                                </div>
                            </div>
                            <div class="result-output">
                                <div class="result-title">æ‰§è¡Œç»“æœï¼š</div>
                                Query OK, 5 rows affected (0.01 sec)<br>
                                Records: 5  Duplicates: 0  Warnings: 0
                            </div>
                        </div>
                    </div>

                    <div class="code-section">
                        <div class="code-header sql">
                            <span>ğŸ” æ•°æ®æŸ¥è¯¢æ“ä½œ</span>
                            <span class="difficulty-badge difficulty-intermediate">ä¸­çº§</span>
                        </div>
                        <div class="code-content">
                            <div class="code-container">
                                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                                <div class="code">
                                    <pre>-- åŸºç¡€æŸ¥è¯¢
SELECT * FROM users;
SELECT username, email, first_name, last_name FROM users;

-- æ¡ä»¶æŸ¥è¯¢
SELECT * FROM users WHERE status = 'active';
SELECT * FROM users WHERE birth_date > '1990-01-01';
SELECT * FROM users WHERE first_name LIKE 'å¼ %';

-- æ’åºå’Œé™åˆ¶
SELECT * FROM users ORDER BY created_at DESC;
SELECT * FROM users ORDER BY last_name, first_name;
SELECT * FROM users ORDER BY birth_date DESC LIMIT 5;
SELECT * FROM users ORDER BY id LIMIT 10 OFFSET 20; -- åˆ†é¡µ

-- èšåˆæŸ¥è¯¢
SELECT COUNT(*) as total_users FROM users;
SELECT status, COUNT(*) as count FROM users GROUP BY status;
SELECT department_id, AVG(salary) as avg_salary FROM employees GROUP BY department_id;
SELECT department_id, MIN(salary), MAX(salary), AVG(salary) FROM employees GROUP BY department_id;

-- å¤šè¡¨è¿æ¥æŸ¥è¯¢
-- å†…è¿æ¥ï¼šè·å–ç”¨æˆ·å’Œå‘˜å·¥ä¿¡æ¯
SELECT 
    u.username,
    u.first_name,
    u.last_name,
    e.employee_id,
    e.position,
    e.salary,
    d.name as department_name
FROM users u
INNER JOIN employees e ON u.id = e.user_id
INNER JOIN departments d ON e.department_id = d.id;

-- å·¦è¿æ¥ï¼šè·å–æ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬éå‘˜å·¥ï¼‰
SELECT 
    u.username,
    u.first_name,
    u.last_name,
    e.employee_id,
    e.position,
    COALESCE(d.name, 'æœªåˆ†é…') as department_name
FROM users u
LEFT JOIN employees e ON u.id = e.user_id
LEFT JOIN departments d ON e.department_id = d.id;

-- å¤æ‚æŸ¥è¯¢ï¼šé¡¹ç›®æˆå‘˜ç»Ÿè®¡
SELECT 
    p.name as project_name,
    p.status,
    COUNT(pm.employee_id) as member_count,
    GROUP_CONCAT(CONCAT(u.first_name, u.last_name) SEPARATOR ', ') as members
FROM projects p
LEFT JOIN project_members pm ON p.id = pm.project_id
LEFT JOIN employees e ON pm.employee_id = e.id
LEFT JOIN users u ON e.user_id = u.id
GROUP BY p.id, p.name, p.status
ORDER BY member_count DESC;

-- å­æŸ¥è¯¢ç¤ºä¾‹
-- æŸ¥æ‰¾è–ªèµ„é«˜äºå¹³å‡è–ªèµ„çš„å‘˜å·¥
SELECT 
    u.first_name,
    u.last_name,
    e.salary
FROM users u
INNER JOIN employees e ON u.id = e.user_id
WHERE e.salary > (SELECT AVG(salary) FROM employees);

-- æŸ¥æ‰¾å‚ä¸é¡¹ç›®æœ€å¤šçš„å‘˜å·¥
SELECT 
    u.first_name,
    u.last_name,
    COUNT(pm.project_id) as project_count
FROM users u
INNER JOIN employees e ON u.id = e.user_id
INNER JOIN project_members pm ON e.id = pm.employee_id
GROUP BY u.id, u.first_name, u.last_name
HAVING project_count = (
    SELECT MAX(project_count) 
    FROM (
        SELECT COUNT(project_id) as project_count 
        FROM project_members 
        GROUP BY employee_id
    ) as counts
);

-- çª—å£å‡½æ•°ï¼ˆMySQL 8.0+ï¼‰
SELECT 
    u.first_name,
    u.last_name,
    e.salary,
    d.name as department,
    ROW_NUMBER() OVER (PARTITION BY e.department_id ORDER BY e.salary DESC) as salary_rank,
    AVG(e.salary) OVER (PARTITION BY e.department_id) as dept_avg_salary,
    LAG(e.salary) OVER (ORDER BY e.salary) as prev_salary
FROM users u
INNER JOIN employees e ON u.id = e.user_id
INNER JOIN departments d ON e.department_id = d.id;

-- CTEï¼ˆå…¬å…±è¡¨è¡¨è¾¾å¼ï¼‰ç¤ºä¾‹
WITH department_stats AS (
    SELECT 
        d.id,
        d.name,
        COUNT(e.id) as employee_count,
        AVG(e.salary) as avg_salary,
        MAX(e.salary) as max_salary
    FROM departments d
    LEFT JOIN employees e ON d.id = e.department_id
    GROUP BY d.id, d.name
),
high_salary_depts AS (
    SELECT * FROM department_stats WHERE avg_salary > 20000
)
SELECT 
    hsd.name,
    hsd.employee_count,
    hsd.avg_salary,
    hsd.max_salary
FROM high_salary_depts hsd
ORDER BY hsd.avg_salary DESC;</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="mongodb">
                    <h2>ğŸŒ¿ MongoDB æ“ä½œ</h2>
                    
                    <div class="code-section">
                        <div class="code-header nosql">
                            <span>ğŸ“„ æ–‡æ¡£æ“ä½œåŸºç¡€</span>
                            <span class="difficulty-badge difficulty-beginner">åˆçº§</span>
                        </div>
                        <div class="code-content">
                            <div class="tag-list">
                                <span class="tag nosql">MongoDB</span>
                                <span class="tag">æ–‡æ¡£</span>
                                <span class="tag">CRUD</span>
                            </div>
                            <div class="code-container">
                                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                                <div class="code">
                                    <pre>// è¿æ¥åˆ°MongoDB
use company_db

// åˆ›å»ºç”¨æˆ·é›†åˆå¹¶æ’å…¥æ–‡æ¡£
db.users.insertOne({
    username: "zhangsan",
    email: "zhangsan@company.com",
    profile: {
        firstName: "ä¸‰",
        lastName: "å¼ ",
        phone: "13800138001",
        birthDate: new Date("1990-05-15"),
        gender: "M"
    },
    address: {
        street: "ä¸­å±±è·¯123å·",
        city: "åŒ—äº¬",
        province: "åŒ—äº¬å¸‚",
        zipCode: "100000"
    },
    preferences: {
        language: "zh-CN",
        timezone: "Asia/Shanghai",
        notifications: {
            email: true,
            sms: false,
            push: true
        }
    },
    tags: ["developer", "senior", "fullstack"],
    status: "active",
    createdAt: new Date(),
    updatedAt: new Date()
});

// æ‰¹é‡æ’å…¥æ–‡æ¡£
db.users.insertMany([
    {
        username: "lisi",
        email: "lisi@company.com",
        profile: {
            firstName: "å››",
            lastName: "æ",
            phone: "13800138002",
            birthDate: new Date("1988-08-20"),
            gender: "F"
        },
        address: {
            street: "è§£æ”¾è·¯456å·",
            city: "ä¸Šæµ·",
            province: "ä¸Šæµ·å¸‚",
            zipCode: "200000"
        },
        tags: ["designer", "creative"],
        status: "active",
        createdAt: new Date(),
        updatedAt: new Date()
    },
    {
        username: "wangwu",
        email: "wangwu@company.com",
        profile: {
            firstName: "äº”",
            lastName: "ç‹",
            phone: "13800138003",
            birthDate: new Date("1992-12-10"),
            gender: "M"
        },
        address: {
            street: "äººæ°‘è·¯789å·",
            city: "å¹¿å·",
            province: "å¹¿ä¸œçœ",
            zipCode: "510000"
        },
        tags: ["manager", "leadership"],
        status: "active",
        createdAt: new Date(),
        updatedAt: new Date()
    }
]);

// æŸ¥è¯¢æ–‡æ¡£
// æŸ¥æ‰¾æ‰€æœ‰ç”¨æˆ·
db.users.find();

// æ¡ä»¶æŸ¥è¯¢
db.users.find({ status: "active" });
db.users.find({ "profile.gender": "M" });
db.users.find({ tags: "developer" });
db.users.find({ tags: { $in: ["developer", "designer"] } });

// å¤æ‚æŸ¥è¯¢
db.users.find({
    $and: [
        { status: "active" },
        { "profile.birthDate": { $gte: new Date("1990-01-01") } },
        { tags: { $in: ["developer", "manager"] } }
    ]
});

// æŠ•å½±æŸ¥è¯¢ï¼ˆåªè¿”å›æŒ‡å®šå­—æ®µï¼‰
db.users.find(
    { status: "active" },
    { username: 1, email: 1, "profile.firstName": 1, "profile.lastName": 1 }
);

// æ’åºå’Œé™åˆ¶
db.users.find().sort({ createdAt: -1 });
db.users.find().sort({ "profile.lastName": 1, "profile.firstName": 1 });
db.users.find().limit(5);
db.users.find().skip(10).limit(5); // åˆ†é¡µ

// èšåˆæŸ¥è¯¢
db.users.aggregate([
    // æŒ‰æ€§åˆ«åˆ†ç»„ç»Ÿè®¡
    {
        $group: {
            _id: "$profile.gender",
            count: { $sum: 1 },
            avgAge: {
                $avg: {
                    $divide: [
                        { $subtract: [new Date(), "$profile.birthDate"] },
                        365.25 * 24 * 60 * 60 * 1000
                    ]
                }
            }
        }
    }
]);

// å¤æ‚èšåˆç®¡é“
db.users.aggregate([
    // åŒ¹é…æ´»è·ƒç”¨æˆ·
    { $match: { status: "active" } },
    
    // æ·»åŠ è®¡ç®—å­—æ®µ
    {
        $addFields: {
            age: {
                $floor: {
                    $divide: [
                        { $subtract: [new Date(), "$profile.birthDate"] },
                        365.25 * 24 * 60 * 60 * 1000
                    ]
                }
            },
            fullName: {
                $concat: ["$profile.lastName", "$profile.firstName"]
            }
        }
    },
    
    // æŒ‰åŸå¸‚åˆ†ç»„
    {
        $group: {
            _id: "$address.city",
            userCount: { $sum: 1 },
            avgAge: { $avg: "$age" },
            users: {
                $push: {
                    username: "$username",
                    fullName: "$fullName",
                    age: "$age"
                }
            }
        }
    },
    
    // æ’åº
    { $sort: { userCount: -1 } }
]);

// æ›´æ–°æ–‡æ¡£
// æ›´æ–°å•ä¸ªæ–‡æ¡£
db.users.updateOne(
    { username: "zhangsan" },
    {
        $set: {
            "preferences.notifications.email": false,
            updatedAt: new Date()
        },
        $push: { tags: "teamlead" }
    }
);

// æ›´æ–°å¤šä¸ªæ–‡æ¡£
db.users.updateMany(
    { status: "active" },
    {
        $set: { updatedAt: new Date() },
        $inc: { loginCount: 1 }
    }
);

// æ›¿æ¢æ–‡æ¡£
db.users.replaceOne(
    { username: "lisi" },
    {
        username: "lisi",
        email: "lisi@company.com",
        profile: {
            firstName: "å››",
            lastName: "æ",
            phone: "13800138002",
            birthDate: new Date("1988-08-20"),
            gender: "F"
        },
        status: "active",
        updatedAt: new Date()
    }
);

// åˆ é™¤æ–‡æ¡£
db.users.deleteOne({ username: "testuser" });
db.users.deleteMany({ status: "inactive" });

// åˆ›å»ºç´¢å¼•
db.users.createIndex({ username: 1 }, { unique: true });
db.users.createIndex({ email: 1 }, { unique: true });
db.users.createIndex({ "profile.lastName": 1, "profile.firstName": 1 });
db.users.createIndex({ tags: 1 });
db.users.createIndex({ createdAt: -1 });

// å¤åˆç´¢å¼•
db.users.createIndex({ 
    status: 1, 
    "address.city": 1, 
    createdAt: -1 
});

// æ–‡æœ¬ç´¢å¼•ï¼ˆç”¨äºå…¨æ–‡æœç´¢ï¼‰
db.users.createIndex({
    username: "text",
    "profile.firstName": "text",
    "profile.lastName": "text"
});

// ä½¿ç”¨æ–‡æœ¬æœç´¢
db.users.find({ $text: { $search: "å¼ ä¸‰" } });</pre>
                                </div>
                            </div>
                            <div class="result-output">
                                <div class="result-title">æ‰§è¡Œç»“æœç¤ºä¾‹ï¼š</div>
                                {<br>
                                &nbsp;&nbsp;"acknowledged": true,<br>
                                &nbsp;&nbsp;"insertedId": ObjectId("...")
                                <br>}
                            </div>
                        </div>
                    </div>
                </section>

                <section id="redis">
                    <h2>ğŸ”´ Redis ç¼“å­˜æ“ä½œ</h2>
                    
                    <div class="code-section">
                        <div class="code-header redis">
                            <span>âš¡ Redis åŸºç¡€æ“ä½œ</span>
                            <span class="difficulty-badge difficulty-intermediate">ä¸­çº§</span>
                        </div>
                        <div class="code-content">
                            <div class="tag-list">
                                <span class="tag redis">Redis</span>
                                <span class="tag">ç¼“å­˜</span>
                                <span class="tag">é”®å€¼</span>
                            </div>
                            <div class="code-container">
                                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                                <div class="code">
                                    <pre># è¿æ¥Redis
redis-cli

# å­—ç¬¦ä¸²æ“ä½œ
SET user:1001:name "å¼ ä¸‰"
GET user:1001:name
SET user:1001:email "zhangsan@company.com"
MSET user:1001:phone "13800138001" user:1001:age "33"
MGET user:1001:name user:1001:email user:1001:phone

# è®¾ç½®è¿‡æœŸæ—¶é—´
SET session:abc123 "user_data" EX 3600  # 1å°æ—¶åè¿‡æœŸ
SETEX cache:user:1001 300 '{"name":"å¼ ä¸‰","email":"zhangsan@company.com"}'
TTL session:abc123  # æŸ¥çœ‹å‰©ä½™æ—¶é—´

# æ•°å­—æ“ä½œ
SET counter:page_views 0
INCR counter:page_views
INCRBY counter:page_views 10
DECR counter:page_views
DECRBY counter:page_views 5

# å“ˆå¸Œæ“ä½œï¼ˆé€‚åˆå­˜å‚¨å¯¹è±¡ï¼‰
HSET user:1001 name "å¼ ä¸‰" email "zhangsan@company.com" age 33
HGET user:1001 name
HMGET user:1001 name email age
HGETALL user:1001
HINCRBY user:1001 age 1
HEXISTS user:1001 phone
HDEL user:1001 age

# åˆ—è¡¨æ“ä½œï¼ˆé€‚åˆé˜Ÿåˆ—ã€æ ˆï¼‰
# å·¦ä¾§æ’å…¥ï¼ˆé˜Ÿåˆ—å¤´éƒ¨ï¼‰
LPUSH queue:tasks "task1" "task2" "task3"
# å³ä¾§æ’å…¥ï¼ˆé˜Ÿåˆ—å°¾éƒ¨ï¼‰
RPUSH queue:tasks "task4" "task5"
# è·å–åˆ—è¡¨é•¿åº¦
LLEN queue:tasks
# è·å–èŒƒå›´å†…çš„å…ƒç´ 
LRANGE queue:tasks 0 -1  # è·å–æ‰€æœ‰å…ƒç´ 
LRANGE queue:tasks 0 2   # è·å–å‰3ä¸ªå…ƒç´ 
# å¼¹å‡ºå…ƒç´ 
LPOP queue:tasks  # ä»å·¦ä¾§å¼¹å‡º
RPOP queue:tasks  # ä»å³ä¾§å¼¹å‡º

# é˜»å¡å¼å¼¹å‡ºï¼ˆç”¨äºå®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼‰
BLPOP queue:tasks 10  # é˜»å¡10ç§’ç­‰å¾…å…ƒç´ 

# é›†åˆæ“ä½œï¼ˆæ— åºã€å”¯ä¸€ï¼‰
SADD tags:user:1001 "developer" "senior" "fullstack"
SMEMBERS tags:user:1001
SISMEMBER tags:user:1001 "developer"
SCARD tags:user:1001  # è·å–é›†åˆå¤§å°

# é›†åˆè¿ç®—
SADD tags:user:1002 "designer" "creative" "senior"
SINTER tags:user:1001 tags:user:1002  # äº¤é›†
SUNION tags:user:1001 tags:user:1002  # å¹¶é›†
SDIFF tags:user:1001 tags:user:1002   # å·®é›†

# æœ‰åºé›†åˆæ“ä½œï¼ˆå¸¦åˆ†æ•°æ’åºï¼‰
ZADD leaderboard 100 "player1" 85 "player2" 92 "player3"
ZRANGE leaderboard 0 -1 WITHSCORES  # æŒ‰åˆ†æ•°å‡åº
ZREVRANGE leaderboard 0 -1 WITHSCORES  # æŒ‰åˆ†æ•°é™åº
ZRANK leaderboard "player2"  # è·å–æ’å
ZSCORE leaderboard "player1"  # è·å–åˆ†æ•°
ZINCRBY leaderboard 5 "player2"  # å¢åŠ åˆ†æ•°

# æŒ‰åˆ†æ•°èŒƒå›´æŸ¥è¯¢
ZRANGEBYSCORE leaderboard 80 95 WITHSCORES
ZCOUNT leaderboard 80 95  # ç»Ÿè®¡åˆ†æ•°èŒƒå›´å†…çš„æˆå‘˜æ•°

# ä½å›¾æ“ä½œï¼ˆé€‚åˆç»Ÿè®¡ï¼‰
# ç”¨æˆ·ç­¾åˆ°ç»Ÿè®¡
SETBIT user:1001:checkin:202312 0 1  # 12æœˆ1æ—¥ç­¾åˆ°
SETBIT user:1001:checkin:202312 1 1  # 12æœˆ2æ—¥ç­¾åˆ°
SETBIT user:1001:checkin:202312 3 1  # 12æœˆ4æ—¥ç­¾åˆ°
GETBIT user:1001:checkin:202312 0    # æŸ¥çœ‹12æœˆ1æ—¥æ˜¯å¦ç­¾åˆ°
BITCOUNT user:1001:checkin:202312    # ç»Ÿè®¡12æœˆç­¾åˆ°å¤©æ•°

# HyperLogLogï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰
# ç»Ÿè®¡ç½‘ç«™ç‹¬ç«‹è®¿å®¢
PFADD visitors:20231201 "user1" "user2" "user3"
PFADD visitors:20231201 "user1" "user4"  # user1é‡å¤ï¼Œä¸ä¼šå¢åŠ è®¡æ•°
PFCOUNT visitors:20231201  # è·å–ç‹¬ç«‹è®¿å®¢æ•°

# åœ°ç†ä½ç½®æ“ä½œ
GEOADD locations 116.397128 39.916527 "beijing"
GEOADD locations 121.473701 31.230416 "shanghai"
GEOADD locations 113.264385 23.129163 "guangzhou"

# è®¡ç®—è·ç¦»
GEODIST locations beijing shanghai km

# æŸ¥æ‰¾é™„è¿‘çš„ä½ç½®
GEORADIUS locations 116.397128 39.916527 1000 km WITHDIST WITHCOORD

# å‘å¸ƒè®¢é˜…
# å‘å¸ƒæ¶ˆæ¯
PUBLISH news:tech "æ–°æŠ€æœ¯å‘å¸ƒï¼šRedis 7.0"
PUBLISH news:company "å…¬å¸æ–°é—»ï¼šå¹´ç»ˆèšé¤"

# è®¢é˜…é¢‘é“ï¼ˆéœ€è¦åœ¨å¦ä¸€ä¸ªå®¢æˆ·ç«¯æ‰§è¡Œï¼‰
SUBSCRIBE news:tech news:company

# æ¨¡å¼è®¢é˜…
PSUBSCRIBE news:*

# æµæ“ä½œï¼ˆRedis 5.0+ï¼Œç±»ä¼¼Kafkaï¼‰
# æ·»åŠ æ¶ˆæ¯åˆ°æµ
XADD events:user_actions * user_id 1001 action "login" timestamp 1640995200
XADD events:user_actions * user_id 1002 action "purchase" amount 99.99

# è¯»å–æµæ¶ˆæ¯
XREAD STREAMS events:user_actions 0  # ä»å¤´å¼€å§‹è¯»å–
XRANGE events:user_actions - +       # è·å–æ‰€æœ‰æ¶ˆæ¯

# æ¶ˆè´¹è€…ç»„
XGROUP CREATE events:user_actions analytics_group 0
XREADGROUP GROUP analytics_group consumer1 STREAMS events:user_actions >

# äº‹åŠ¡æ“ä½œ
MULTI
SET account:1001:balance 1000
SET account:1002:balance 500
DECRBY account:1001:balance 100
INCRBY account:1002:balance 100
EXEC

# ç›‘è§†é”®ï¼ˆä¹è§‚é”ï¼‰
WATCH account:1001:balance
MULTI
DECRBY account:1001:balance 100
EXEC

# Luaè„šæœ¬ï¼ˆåŸå­æ“ä½œï¼‰
EVAL "
local current = redis.call('GET', KEYS[1])
if current == false then
    current = 0
else
    current = tonumber(current)
end
if current < tonumber(ARGV[1]) then
    return redis.call('INCRBY', KEYS[1], ARGV[2])
else
    return current
end
" 1 counter:api_calls 100 1

# ç®¡é“æ“ä½œï¼ˆæ‰¹é‡æ‰§è¡Œï¼Œå‡å°‘ç½‘ç»œå¾€è¿”ï¼‰
# åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ä½¿ç”¨pipeline
# pipeline = redis.pipeline()
# pipeline.set('key1', 'value1')
# pipeline.set('key2', 'value2')
# pipeline.get('key1')
# results = pipeline.execute()

# é”®ç®¡ç†
KEYS user:*  # æŸ¥æ‰¾åŒ¹é…çš„é”®ï¼ˆç”Ÿäº§ç¯å¢ƒæ…ç”¨ï¼‰
SCAN 0 MATCH user:* COUNT 10  # å®‰å…¨çš„é”®æ‰«æ
EXISTS user:1001:name
TYPE user:1001:name
EXPIRE user:1001:name 3600
PERSIST user:1001:name  # ç§»é™¤è¿‡æœŸæ—¶é—´
DEL user:1001:name

# æ•°æ®åº“ç®¡ç†
SELECT 1  # åˆ‡æ¢åˆ°æ•°æ®åº“1
FLUSHDB  # æ¸…ç©ºå½“å‰æ•°æ®åº“
FLUSHALL  # æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“
INFO  # æŸ¥çœ‹Redisä¿¡æ¯
CONFIG GET maxmemory  # æŸ¥çœ‹é…ç½®</pre>
                                </div>
                            </div>
                            <div class="result-output">
                                <div class="result-title">æ‰§è¡Œç»“æœç¤ºä¾‹ï¼š</div>
                                127.0.0.1:6379> SET user:1001:name "å¼ ä¸‰"<br>
                                OK<br>
                                127.0.0.1:6379> GET user:1001:name<br>
                                "å¼ ä¸‰"
                            </div>
                        </div>
                    </div>
                </section>

                <div class="footer-resources">
                    <h3>ğŸ”— ç›¸å…³èµ„æº</h3>
                    <p>
                        <a href="sql.html">ğŸ—ƒï¸ SQL æ•™ç¨‹</a> |
                        <a href="nosql.html">ğŸŒŒ NoSQL æ•™ç¨‹</a> |
                        <a href="../backend/backend-guide.html">ğŸ›¸ åç«¯ä»£ç å¤§å…¨</a> |
                        <a href="../playground.html">ğŸ® ä»£ç æ¸¸ä¹åœº</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/galaxy-background.js"></script>
    <script src="../js/navigation.js"></script>
    <script>
        // å¤åˆ¶ä»£ç åŠŸèƒ½
        function copyCode(button) {
            const codeBlock = button.nextElementSibling.querySelector('pre');
            const text = codeBlock.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'å·²å¤åˆ¶!';
                button.style.background = 'var(--success-color)';
                button.style.color = 'white';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                    button.style.color = '';
                }, 2000);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                button.textContent = 'å¤åˆ¶å¤±è´¥';
                setTimeout(() => {
                    button.textContent = 'å¤åˆ¶';
                }, 2000);
            });
        }
    </script>
</body>
</html> 